+++
Sources = [
"https://github.com/paulmckrcu/oota",
"https://lwn.net/Articles/827180/can-a-speculatively-executed-cpu-branch-contain-opcodes-that-access-ram/64148401#64148401",
"https://lwn.net/Articles/718628/size-of-store-buffers-on-intel-hardware-what-exactly-is-a-store-buffer",
"http://www.rdrop.com/users/paulmck/scalability/paper/whymb.2010.07.23a.pdf",
"https://pages.cs.wisc.edu/~markhill/papers/primer2020_2nd_edition.pdf",

]
authors = [
"Michael Shalitin",

]
math = true
date = "2025-01-11"
categories = [

]
series = [

]
title = "Causal & Physics"
+++


## ראייה מורכבת יותר של זיכרון

מערכות מחשוב מודרניות מספקות אופטימיזציות וביצועים גבוהים אבל זה לא מגיע בחינם, כל אלה גורמים לסיבוך משמעותי, ולכן הרבה פעמים משתמשים בכלים שגורמים לכל הסיבוך הזה להיות שקוף כלפי המשתמש כמו שפות high level,  מנגנוני נעילה וכל מיני מנגנונים אחרים.

בצורה הזאת אפשר לדמות שפות high level ומנגנוני נעילה למערכת שמתפקדת על פי עקרונות של פיזיקה ניוטונית: כשיש נעילה, המערכת מתנהגת בצורה דטרמיניסטית וצפויה, וניתן לדעת בוודאות מה יתרחש בכל מצב נתון. לעומת זאת, במעבר לרמות נמוכות יותר של ניהול זיכרון (למשל, ניהול זיכרון במערכות מרובות ליבות ללא נעילה), המצב מתחיל להזכיר את עקרונות הפיזיקה הקוונטית, שבהם אירועים מפתיעים יכולים להתרחש, וההבנה המלאה של התהליכים מורכבת יותר. רק מעטים יטענו שהם מבינים את כל ההתרחשויות בעולם הזה. אמנם לרוב ניתן לפעול היטב בסביבה זו מבלי להבין את הפרטים המורכבים, אך ישנם מקרים שבהם ידע מעמיק בתחום, נחוץ כדי להבין ולפתור בעיות מורכבות.

## multi-copy atomicity

העיקרון של טרנזיטיביות מספק הבנה אינטואיטיבית של סדר סיבתי במערכות: אם תהליך B נחשף לתוצאות של פעולה שביצע תהליך A, ולאחר מכן תהליך C נחשף לתוצאות של פעולה שביצע תהליך B, אז תהליך C חייב לראות גם את התוצאות של פעולתו של A. כלומר, התפשטות ההשפעות בין התהליכים שומרת על סדר כרונולוגי והגיוני, כך שהמידע שהתפשט דרך תהליך ביניים אחד מועבר גם לתהליך הבא בצורה עקבית.

לרוב אנחנו מניחים שפעולות במערכת מסויימת היו טרנזיטיביות אבל זה לא תמיד נכון בכל הארכיטקטורות (כמו ב-PPC, ו-ARMv7).

סיבתיות אינה מבטיחה בהכרח multi-copy atomicity, ה-multi-copy atomicity מרמז על קיום קשר סיבתי בין פעולות. כאשר כתיבה היא multi-copy atomicity, המשמעות היא שכל התהליכים במערכת רואים את השינויים הנגרמים ממנה באותו סדר ובאופן עקבי, מה שמבטיח סיבתיות ברורה.

הפרה של multi-copy atomicity במקרה של מערכות מרובות ליבות המשתמשות ב-forward buffer משותף, ליבות שחולקות את אותו buffer יכולות לראות את השינויים שנעשו בכתיבה, בעוד ליבות שאינן חולקות את אותו buffer לא יוכלו לראות אותם מיד. במצב כזה, למרות שיש סיבתיות במובן שמי שחולק את ה-buffer יכול לראות את הכתיבה, המצב מפר את הרעיון של multi-copy atomicity, שכן לא כל הליבות רואות את השינוי בו-זמנית.

## אילוצים בעולם האמיתי

היישום של תקני שפה כמו C++ בעולם האמיתי מושפע ממגבלות הנכפות על ידי חומרה ופיזיקה, התקן מגדיר מכונה מופשטת אך במציאות, יש למפות אותה למערכת פיזית המורכבת מחומר ואנרגיה אמיתיים. תהליך מיפוי זה מוסיף מגבלות נוספות שמקורן בחוקי הפיזיקה ובעיצובי חומרה, אשר נבחנו בצורה חלקית בלבד בתקן ובמחקרים הקודמים. אחת הסיבות לכך היא שמודלי זיכרון חומרה מדויקים ורשמיים, הניתנים ליישום, לא היו זמינים לפני פרסום התקן. 

## חוקי הפיזיקה

ממצאים מדעיים מראים שהיקום פועל לפי עקרונות סיבתיים, שמהירות האור היא סופית, ואטומים הם בגודל שאינו אפס. חוקי פיזיקה בסיסיים אלו, היותם אמפיריים, נתמכים במיליוני תצפיות שנצברו הרבה לפני המצאת המחשבים האלקטרוניים ובוודאי לפני פיתוח שפות תכנות התומכות במקביליות.

### סיבתיות (Causality)

סיבתיות היא עקרון יסודי שקובע כי כל תוצאה נגרמת על ידי סיבה שקודמת לה בזמן. כלומר, אירוע מסוים לא יכול להתרחש לפני האירוע שגרם לו, אלא תמיד אחריו. במילים אחרות, מדובר בקביעה על הסדר הכרונולוגי של האירועים, שמכתיבה את היחס הסיבתי ביניהם, כך שהסיבה מופיעה תחילה ורק לאחר מכן ההשפעה שלה באה לידי ביטוי.

המאמר מתבסס על העיקרון שאין תהליך שבו תוצאה יכולה להתרחש לפני הסיבה במערכת מחשוב כלשהי בעולם הפיזי.

### מהירות אור סופית

מדידות פיזיקליות בקנה מידה גדול תומכות בכך שמהירות האור היא סופית. לכן, המאמר יוצא מנקודת הנחה שמהירות האור מוגבלת, וכך גם המהירות המרבית שבה מידע יכול להתפשט במרחב.

במידה ומהירות האור הייתה אינסופית, אפשר היה להעביר מידע בצורה מיידית לכל יעד, בלי תלות במרחק. מצב כזה היה מאפשר לפקודת load להחזיר את הערך שנשמר על ידי thread אחר באופן מיידי עם ביצוע ה-store, מה שהיה מבטל את השפעת עיכוב ההתפשטות בתור גורם מונע להיווצרות לולאות סיבתיות כמו מחזורי OOTA.

### אטומים שאינם בגודל אפס

במקרה שאטומים היו בגודל אפס, ניתן היה לבנות מחשב בגודל אפס. במחשב שכזה, גם אם מהירות האור מוגבלת, היה ניתן להפיץ מידע בין רכיבי המחשב באופן מיידי. כך, הפקודה load הייתה יכולה לקבל את הערך שנכתב על ידי thread אחר בו-זמנית עם ביצוע ה-store, מה שהיה מסיר את עיכוב ההתפשטות בתור גורם המונע לולאות סיבתיות כמו מחזורי OOTA.

עם זאת, נכון לעכשיו לא הצליחו לפתח מחשב בגודל אפס המסוגל להריץ תוכניות C++ מורכבות. לכן, מאמר זה מניח שכל מחשב שמסוגל להריץ C++ יהיה בעל גודל פיזי כלשהו, מה שמונע היווצרות של לולאות סיבתיות על בסיס מחשבים בגודל אפס.

### חוקי הפיזיקה: השלכות

שלושת חוקי הפיזיקה שצוינו מבססים עקרון לפיו כאשר thread אחד טוען ערך שנכתב על ידי thread אחר, פעולת ה-load חייבת להתרחש מאוחר יותר במונחי הזמן הגלובלי לעומת פעולת ה-store. כלומר, הקשר בין פעולת ה-load לפעולת ה-store הוא בעל טבע זמני.

לעומת זאת, ב-C++11, יחס שינוי-סדר (modification-order) אינו מתבסס על זמן. במערכות מחשוב, ניתן לזהות ולהסיק את סדר השינויים של קבוצת פעולות store הרבה זמן לאחר שבוצעו בפועל. במילים אחרות, פעולת store שהתרחשה מוקדם יותר במונחי זמן גלובלי עשויה להופיע בסדר השינויים של אובייקט כלשהו מאוחר יותר בהשוואה לפעולה שהתרחשה מאוחר יותר בזמן הגלובלי. הא-טמפורליות (atemporality) הזו נובעת מאופטימיזציות חומרה כמו store buffer-ים.

שפות תכנות עם מכונות מופשטות קיימות אינן מיישמות במלואן את האילוצים הזמניים הללו, ולכן מתקשות להבטיח שלילה יעילה של התנהגויות OOTA.

## ארכיטקטורה ועיצוב חומרה

בניגוד למצב שהיה בתחילת תהליך פיתוח מודל הזיכרון של C++11, כיום, למשפחות רבות של מעבדים יש מודלים פורמליים ומדויקים של זיכרון, שניתן לבצע עליהם ניתוח והפעלה. כל המודלים הללו אוסרים על קיומם של מחזורים סיבתיים.
### ויכוחים על סיבתיות

מושג הסיבתיות, שמבוסס על הרעיון שאירועים נגרמים מאירועים קודמים באופן עקבי וניתן לחיזוי, מהווה עקרון יסודי בתיאוריות מדעיות רבות ומכונן את הבנתנו את העולם. אולם, כשמעמיקים ברבדים הבסיסיים ביותר של היקום, כמו בפיזיקה קוונטית או בדיונים על מקורות היקום, התמונה של סיבתיות מוחלטת הופכת למורכבת יותר.

בפיזיקה קלאסית, סיבתיות מוסברת לעיתים באמצעות חוקים דטרמיניסטיים, כלומר כל אירוע נגרם באופן ישיר על ידי אירועים מוקדמים יותר. עם זאת, במכניקת הקוונטים, התנהגותם של חלקיקים נוטה להיות הסתברותית ולא ודאית. מכניקת הקוונטים מציגה מימד של אקראיות ואי-ודאות, מה שמערער את התפיסה המסורתית של סיבתיות דטרמיניסטית.

בנוסף, כשבוחנים את היווצרות היקום במפץ הגדול, חוקי הפיזיקה הקיימים מתחילים להתפרק בתנאים הקיצוניים של צפיפות וטמפרטורה גבוהות במיוחד. ישנן תיאוריות שמציעות כי התנאים הקיימים ממש בתחילת היקום אינם מתאימים להבנה הקלאסית של סיבתיות. יתרה מזו, יש הטוענים כי הזמן עצמו החל עם המפץ הגדול, מה שמקשה להחיל את המושג המסורתי של סיבתיות בתוך הקשר זה.

מצד אחד, ניתן לטעון בעוצמה שהיקום פועל לפי עקרון הסיבתיות. רוב הידע הפיזיקלי שלנו בנוי על הבנה זו, לפיה לכל אירוע יש סיבה קודמת. עיקרון זה הוכיח את עצמו בניבוי והבנה של התנהגות היקום בקנה מידה רחב, ומדי יום הניסיון האנושי שלנו מאשר את קיומו של קשר סיבתי בין אירועים. קשה להאמין שזו רק אשליה.

מצד שני, ישנם אתגרים לעקרון הסיבתיות במובן המוחלט שלו. אחד מהם מגיע ממכניקת הקוונטים, שם נראה שאירועים מסוימים פשוט אינם סיבתיים מטבעם. דוגמה לכך היא קריסת פונקציית הגל, שנראית כתהליך אקראי ללא סיבה ברורה. יתרה מזאת, ההבנה שלנו לגבי מקור היקום עדיין חלקית מאוד. איננו בטוחים אם למפץ הגדול עצמו הייתה סיבה, או שמא הוא פשוט מהווה את תחילת הכול ללא סיבה קודמת.

בעוד שסיבתיות מהווה עקרון מפתח בהבנת היקום, היישום שלה ברבדים העמוקים יותר – כגון במכניקת הקוונטים או במקור היקום – הופך למורכב. הוויכוחים בנושא ממשיכים להתפתח בפיזיקה ובפילוסופיה, כאשר החוקרים בוחנים את טבעה של הסיבתיות בהקשרים אלו.


